<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper namespace="tblproduct">
	<!--  동적쿼리 예시 : 상품 조회에 필요한 검색필터. 아래 4개 중 하나의 쿼리로 실행되게 할 수 있습니다.
					   동적쿼리를 위해서 where, if, trim 마이바티스 태그 사용합니다.
	-->
	<!-- 예시 :select * from TBL_PRODUCT where category = 'B2' and pname like '%'|| '사과'||'% => 파라미터 2개 모두 있을 때
					또는
				select * from TBL_PRODUCT where category = 'B2';
					또는
			select * from TBL_PRODUCT where pname like '%'|| '사과' ||'%';
					  -->
	<select id="search" resultType="ProductDto" parameterType="java.util.Map">
		select * from tbl_product
		<!-- if 중 하나라도 조건식이 만들어 질때만 where 작성. 아래 if의 test 값은 조건식 입니다.-->
		<where>
		<!-- category 파라미터 값이 null이 아닐 때. -->
			<if test="category!=null">
				category = #{category}
			</if>
			<!-- keyword 파라미터 값이 null이 아닐 때. -->
			<if test="keyword!=null">
				<!-- 앞의 조건식 없으면 and는 트림 -->
				<trim prefix="and">	<!-- 이 위치에 and 문자열을 출력.  -->
				pname like '%' || #{keyword} || '%'
				</trim>
			</if>
		<!-- test 논리연산 : and, or -->
			<if test="from!=null and to!=null">
				<trim prefix="and">
				price between #{from} and #{to}
			</trim>
			</if>
		</where>
		ORDER BY ${column}
	</select>
	
	<select id="selectByCategory" parameterType="String" resultType="ProductDto">
		SELECT * FROM TBL_PRODUCT
		WHERE CATEGORY = #{category}
		ORDER BY PNAME
	</select>

	<select id="selectByPname" parameterType="String" resultType="ProductDto">
		SELECT * FROM TBL_PRODUCT
		WHERE PNAME LIKE '%' ||#{pname} || '%'
		ORDER BY CATEGORY
	</select>
</mapper>
 